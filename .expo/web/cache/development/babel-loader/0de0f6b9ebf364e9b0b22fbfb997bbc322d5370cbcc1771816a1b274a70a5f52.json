{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport general from \"../../utils/general\";\nimport { ValidationMessages, ValidationRules } from \"./validation-rules\";\nvar Validator = function () {\n  function Validator() {\n    _classCallCheck(this, Validator);\n    this.constraints = {};\n    this.isValid = false;\n    this.scopeKey = general.generateRandomString(5);\n    this.items = {};\n    this.coordinates = {};\n  }\n  _createClass(Validator, [{\n    key: \"generateNewScopeKey\",\n    value: function generateNewScopeKey() {\n      this.scopeKey = general.generateRandomString(5);\n      return this.scopeKey;\n    }\n  }, {\n    key: \"isNullOrEmpty\",\n    value: function isNullOrEmpty(value) {\n      return value === \"\" || value === null || value === undefined || value instanceof Array && (value == null ? void 0 : value.length) === 0;\n    }\n  }, {\n    key: \"allValid\",\n    value: function allValid() {\n      var data = this.allValidWithFirstInvalidItem();\n      return data.isValid;\n    }\n  }, {\n    key: \"allValidWithFirstInvalidItem\",\n    value: function allValidWithFirstInvalidItem() {\n      var _this = this;\n      var isValid = true;\n      var firstInvalidItem = {};\n      Object.keys(this.items).map(function (key) {\n        var _firstInvalidItem, _firstInvalidItem$coo;\n        var item = _this.items[key];\n        if (item.scopeKey !== _this.scopeKey) return;\n        var errMsg = _this.validateAndGetErrorMessage(key, _this.items[key].lastValue, true);\n        if (!_this.isNullOrEmpty(errMsg) && (isValid || _this.isNullOrEmpty((_firstInvalidItem = firstInvalidItem) == null ? void 0 : (_firstInvalidItem$coo = _firstInvalidItem.coordinate) == null ? void 0 : _firstInvalidItem$coo.y))) {\n          isValid = false;\n          var _item = _this.items[key];\n          firstInvalidItem = _objectSpread({}, _item);\n          firstInvalidItem.name = key;\n          if (!_this.isNullOrEmpty(_item == null ? void 0 : _item.coordinateProviderName) && _this.coordinates[_item == null ? void 0 : _item.coordinateProviderName]) {\n            firstInvalidItem.coordinate = _objectSpread({}, _this.coordinates[_item == null ? void 0 : _item.coordinateProviderName]);\n          }\n        }\n      });\n      return {\n        isValid: isValid,\n        firstInvalidItem: firstInvalidItem\n      };\n    }\n  }, {\n    key: \"registerDestructuring\",\n    value: function registerDestructuring(_ref) {\n      var name = _ref.name,\n        value = _ref.value,\n        rules = _ref.rules,\n        validatorScopeKey = _ref.validatorScopeKey,\n        _ref$setChangedAnyway = _ref.setChangedAnyway,\n        setChangedAnyway = _ref$setChangedAnyway === void 0 ? false : _ref$setChangedAnyway,\n        coordinateProviderName = _ref.coordinateProviderName;\n      return this.register(name, value, rules, validatorScopeKey, setChangedAnyway, coordinateProviderName);\n    }\n  }, {\n    key: \"register\",\n    value: function register(name, value, rules, scopeKey) {\n      var setChangedAnyway = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n      var coordinateProviderName = arguments.length > 5 ? arguments[5] : undefined;\n      if (!this.items[name]) {\n        this.items[name] = {\n          lastValue: null,\n          rules: rules,\n          errorMessage: null,\n          scopeKey: scopeKey,\n          isChangedBefore: false,\n          coordinateProviderName: coordinateProviderName\n        };\n      }\n      var item = this.items[name];\n      item.scopeKey = scopeKey;\n      item.rules = rules;\n      var errMsg = this.validateAndGetErrorMessage(name, value, setChangedAnyway);\n      this.items[name].lastValue = value;\n      return errMsg;\n    }\n  }, {\n    key: \"registerLayoutForCoordinateProvider\",\n    value: function registerLayoutForCoordinateProvider(name, layoutEvent) {\n      var layout = layoutEvent.nativeEvent.layout;\n      this.coordinates[name] = _objectSpread({}, layout);\n    }\n  }, {\n    key: \"validateAndGetErrorMessage\",\n    value: function validateAndGetErrorMessage(name, value) {\n      var setChangedAnyway = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var item = this.items[name];\n      if (setChangedAnyway) item.isChangedBefore = true;\n      item.lastValue = value;\n      if (!this.isNullOrEmpty(value)) item.isChangedBefore = true;\n      if (!item.isChangedBefore && this.isNullOrEmpty(value)) {\n        item.errorMessage = null;\n        return null;\n      }\n      var errMsg = \"\";\n      for (var i = 0; i < item.rules.length; i++) {\n        var ruleItem = item.rules[i];\n        var isValid = ValidationRules[ruleItem.rule](value, ruleItem == null ? void 0 : ruleItem.value);\n        if (!isValid) {\n          var _ruleItem$message;\n          var msg = (_ruleItem$message = ruleItem == null ? void 0 : ruleItem.message) != null ? _ruleItem$message : ValidationMessages[ruleItem.rule](value, ruleItem == null ? void 0 : ruleItem.value);\n          errMsg = msg;\n          break;\n        }\n      }\n      item.errorMessage = errMsg;\n      return errMsg;\n    }\n  }], [{\n    key: \"addValidationRule\",\n    value: function addValidationRule(name, validateCallback, messageCallback) {\n      ValidationMessages[name] = messageCallback;\n      ValidationRules[name] = validateCallback;\n    }\n  }, {\n    key: \"removeValidationRule\",\n    value: function removeValidationRule(name) {\n      delete ValidationMessages[name];\n      delete ValidationRules[name];\n    }\n  }]);\n  return Validator;\n}();\nexport default Validator;","map":{"version":3,"names":["general","ValidationMessages","ValidationRules","Validator","_classCallCheck","constraints","isValid","scopeKey","generateRandomString","items","coordinates","_createClass","key","value","generateNewScopeKey","isNullOrEmpty","undefined","Array","length","allValid","data","allValidWithFirstInvalidItem","_this","firstInvalidItem","Object","keys","map","_firstInvalidItem","_firstInvalidItem$coo","item","errMsg","validateAndGetErrorMessage","lastValue","coordinate","y","_objectSpread","name","coordinateProviderName","registerDestructuring","_ref","rules","validatorScopeKey","_ref$setChangedAnyway","setChangedAnyway","register","arguments","errorMessage","isChangedBefore","registerLayoutForCoordinateProvider","layoutEvent","layout","nativeEvent","i","ruleItem","rule","_ruleItem$message","msg","message","addValidationRule","validateCallback","messageCallback","removeValidationRule"],"sources":["/Users/yavuzceliker/Desktop/projects/yavuz/react/qr4car/mobile/app/infrastructure/validator/index.js"],"sourcesContent":["import general from \"../../utils/general\";\nimport { ValidationMessages, ValidationRules } from \"./validation-rules\";\nclass Validator {\n\n    constructor() {\n        this.constraints = {};\n        this.isValid = false;\n        this.scopeKey = general.generateRandomString(5);\n        this.items = {}\n        this.coordinates = {}\n    }\n\n    generateNewScopeKey() {\n        this.scopeKey = general.generateRandomString(5);\n        return this.scopeKey;\n    }\n\n\n    isNullOrEmpty(value) {\n        return (value === \"\" || value === null || value === undefined || (value instanceof Array && value?.length === 0))\n    }\n\n    static addValidationRule(name, validateCallback, messageCallback) {\n        ValidationMessages[name] = messageCallback;\n        ValidationRules[name] = validateCallback;\n    };\n\n    static removeValidationRule(name) {\n        delete ValidationMessages[name];\n        delete ValidationRules[name];\n    };\n\n    allValid() {\n        var data = this.allValidWithFirstInvalidItem();\n        return data.isValid;\n  \n    }\n\n   \n    allValidWithFirstInvalidItem() {\n        let isValid = true;\n        let firstInvalidItem = {};\n        Object.keys(this.items).map(key => {\n\n\n            const item = this.items[key];\n            if (item.scopeKey !== this.scopeKey)\n                return; // burada map durmuyor, sadece itemin i≈ülemi kesiliyor\n            var errMsg = this.validateAndGetErrorMessage(key, this.items[key].lastValue, true);\n            if (!this.isNullOrEmpty(errMsg) && (isValid || this.isNullOrEmpty(firstInvalidItem?.coordinate?.y))) {\n                isValid = false;\n                const item = this.items[key];\n                firstInvalidItem = { ...item };\n                firstInvalidItem.name = key;\n                if (!this.isNullOrEmpty(item?.coordinateProviderName) && this.coordinates[item?.coordinateProviderName]) {\n                    firstInvalidItem.coordinate = { ...this.coordinates[item?.coordinateProviderName] };\n                }\n            }\n        });\n        return { isValid, firstInvalidItem };\n    }\n\n    registerDestructuring({ name, value, rules, validatorScopeKey, setChangedAnyway = false, coordinateProviderName }) {\n        return this.register(name, value, rules, validatorScopeKey, setChangedAnyway, coordinateProviderName)\n    }\n\n    register(name, value, rules, scopeKey, setChangedAnyway = false, coordinateProviderName) {\n        if (!this.items[name]) { \n            this.items[name] = {\n                lastValue: null,\n                rules: rules,\n                errorMessage: null,\n                scopeKey,\n                isChangedBefore: false,\n                coordinateProviderName\n            }\n        }\n        const item = this.items[name];\n\n        item.scopeKey = scopeKey;\n        item.rules = rules;\n\n        var errMsg = this.validateAndGetErrorMessage(name, value, setChangedAnyway);\n\n        this.items[name].lastValue = value;\n        return errMsg;\n\n    }\n\n\n\n    registerLayoutForCoordinateProvider(name, layoutEvent) {\n        const layout = layoutEvent.nativeEvent.layout;\n        this.coordinates[name] = { ...layout };\n    }\n\n\n\n    validateAndGetErrorMessage(name, value, setChangedAnyway = false) {\n        const item = this.items[name];\n        if (setChangedAnyway)\n            item.isChangedBefore = true;\n\n\n        item.lastValue = value;\n        if (!this.isNullOrEmpty(value))\n            item.isChangedBefore = true;\n        if (!item.isChangedBefore && this.isNullOrEmpty(value)) {\n            item.errorMessage = null;\n            return null;\n        }\n\n        let errMsg = \"\";\n        for (var i = 0; i < item.rules.length; i++) {\n            const ruleItem = item.rules[i];\n            const isValid = ValidationRules[ruleItem.rule](value, ruleItem?.value);\n            if (!isValid) {\n                const msg = ruleItem?.message ?? ValidationMessages[ruleItem.rule](value, ruleItem?.value);\n                errMsg = msg;\n                break;\n            }\n        }\n        item.errorMessage = errMsg;\n        return errMsg;\n    }\n\n}\n\nexport default Validator;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}